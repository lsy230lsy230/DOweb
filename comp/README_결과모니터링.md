# 댄스스코어 결과 모니터링 시스템

## 개요
댄스스코어에서 생성되는 요약 파일(`숫자.html`)과 상세 파일(`숫자-d.html`)을 자동으로 모니터링하고, 두 파일을 합쳐서 종합 결과를 실시간으로 스크린에 표시하는 시스템입니다.

## 주요 기능
- 🔍 **실시간 파일 모니터링**: 결과 디렉토리를 지속적으로 모니터링
- 📊 **자동 결과 처리**: 새 파일이 생성되면 자동으로 종합 결과 생성
- 🖥️ **전체화면 모니터링**: 이벤트 그룹별 대기화면 및 결과 표시
- 📱 **웹 대시보드**: 모니터링 상태 및 로그 확인
- ⚡ **자동 새로고침**: 30초마다 자동으로 결과 업데이트
- 🎯 **이벤트 제어**: 실시간으로 이벤트 상태 및 결과 발표 제어

## 파일 구조
```
comp/
├── result_monitor.php      # 핵심 모니터링 클래스
├── result_dashboard.php    # 웹 대시보드
├── result_watcher.php      # 백그라운드 모니터링 스크립트
├── monitor_control.php     # 모니터링 제어 페이지
├── event_monitor_v2.php    # 전체화면 이벤트 모니터링 (v2)
├── event_upload.php        # 이벤트 순서 업로드
├── event_control_panel.php # 이벤트 제어 패널
├── competition_settings.php # 대회 설정
├── start_monitoring.bat    # Windows 실행 스크립트
└── README_결과모니터링.md  # 이 파일
```

## 설치 및 설정

### 1. 시스템 요구사항
- PHP 7.4 이상
- Windows 운영체제
- 댄스스코어가 설치된 환경

### 2. 디렉토리 설정
```php
// result_monitor.php에서 결과 디렉토리 경로 설정
private $resultsPath = "Y:/results";
```

### 3. 웹 서버 설정
- Apache 또는 IIS에서 PHP 실행 환경 구성
- `comp` 디렉토리를 웹 루트에 배치

## 사용법

### 방법 1: 웹 인터페이스 사용 (권장)

1. **모니터링 제어 페이지 접속**
   ```
   http://localhost/comp/monitor_control.php
   ```

2. **테스트 페이지로 현재 파일 확인**
   - "테스트 페이지" 버튼 클릭
   - Y:/results 폴더의 기존 파일들 분석 및 테스트

3. **모니터링 시작**
   - "모니터링 시작" 버튼 클릭
   - Y:/results 폴더를 실시간으로 모니터링 시작

4. **전체화면 모니터링**
   - "전체화면 모니터" 버튼 클릭
   - **선수들이 결과를 확인할 수 있는 전체화면 모니터**
   - 자동 순환으로 모든 결과 표시
   - 대기화면, 로고 화면, 결과 화면 전환 가능

5. **대시보드 열기**
   - "대시보드 열기" 버튼 클릭
   - 실시간 모니터링 상태 및 결과 확인

6. **종합 결과 보기**
   - 대시보드에서 "전체화면" 버튼 클릭
   - 또는 `combined_result_이벤트ID.html` 파일 직접 접속

### 방법 2: 명령줄 사용

1. **Windows 배치 파일 실행**
   ```cmd
   start_monitoring.bat
   ```

2. **PHP 직접 실행**
   ```cmd
   php result_watcher.php
   ```

### 방법 3: 수동 결과 처리

1. **대시보드 접속**
   ```
   http://localhost/comp/result_dashboard.php
   ```

2. **결과 처리**
   - "모든 결과 처리" 버튼 클릭
   - 기존 파일들을 일괄 처리

## 결과 파일 형식

### 입력 파일
- **요약 파일**: `83.html` - 최종 순위와 점수
- **상세 파일**: `83-d.html` - 댄스별 상세 점수

### 출력 파일
- **종합 결과**: `combined_result_83.html` - 두 파일을 합친 종합 결과

## 종합 결과 화면 특징

### 📊 최종 순위 섹션
- 순위별 선수 정보
- 최종 점수 표시
- 1, 2, 3위 하이라이트

### 💃 댄스별 상세 결과
- Cha Cha Cha, Samba, Rumba, Paso Doble, Jive
- 각 댄스별 심판 점수
- 댄스별 순위

### 👨‍⚖️ 심판진 정보
- 심판 이름과 국가
- 심판 코드 (A, B, C, ...)

### 🔄 실시간 업데이트
- 30초마다 자동 새로고침
- 수동 새로고침 버튼
- 전체화면 모드

## 고급 설정

### 자동 새로고침 간격 변경
```javascript
// result_dashboard.php에서 수정
setInterval(refreshResults, 30000); // 30초 -> 원하는 초로 변경
```

### 결과 디렉토리 경로 변경
```php
// result_monitor.php에서 수정
public function __construct($resultsPath = "새로운/경로") {
    $this->resultsPath = $resultsPath;
}
```

### 로그 파일 위치 변경
```php
// result_watcher.php에서 수정
private $logFile = "새로운/경로/watcher.log";
```

## 문제 해결

### 1. 파일 권한 오류
- 결과 디렉토리에 읽기/쓰기 권한 확인
- 웹 서버 계정 권한 확인

### 2. PHP 오류
- PHP 버전 확인 (7.4 이상)
- 필요한 확장 모듈 설치 (DOM, SimpleXML)

### 3. 파일 모니터링이 작동하지 않음
- 결과 디렉토리 경로 확인
- 파일 생성 시간 확인
- 로그 파일 확인

### 4. 종합 결과가 생성되지 않음
- 요약 파일과 상세 파일 쌍 확인
- HTML 파싱 오류 확인
- PHP 오류 로그 확인

## 로그 확인

### 모니터링 로그
```
comp/watcher.log
```

### 웹 서버 오류 로그
```
Apache: logs/error.log
IIS: C:\inetpub\logs\LogFiles\
```

## 지원 및 문의

문제가 발생하거나 추가 기능이 필요한 경우:
1. 로그 파일 확인
2. 오류 메시지 기록
3. 시스템 환경 정보 수집

## 업데이트 내역

### v1.0.0 (2024-01-XX)
- 초기 버전 릴리스
- 기본 모니터링 기능
- 웹 대시보드
- 종합 결과 생성

---

**주의사항**: 이 시스템은 댄스스코어와 함께 사용하도록 설계되었습니다. 댄스스코어의 파일 형식이 변경되면 파싱 로직을 수정해야 할 수 있습니다.
